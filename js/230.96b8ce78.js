"use strict";(self["webpackChunkexpr_tool"]=self["webpackChunkexpr_tool"]||[]).push([[230],{3718:(e,t,o)=>{o.d(t,{Z:()=>v});var n=o(3673),r=o(2323);const a={class:"text-h7 text-italic text-bold"};function l(e,t,o,l,i,s){const u=(0,n.up)("q-card-section"),c=(0,n.up)("q-separator"),d=(0,n.up)("q-card"),p=(0,n.up)("q-table");return(0,n.wg)(),(0,n.j4)(p,{rows:e.funcs,columns:e.cols,grid:"","row-key":"name","hide-pagination":"","rows-per-page-options":[0],dark:e.isDark,class:(0,r.C_)({"bg-grey-9":e.isDark})},{item:(0,n.w5)((t=>[(0,n.Wm)(d,{class:"q-mb-xs q-mx-xs",style:{width:"100%"},dark:e.isDark},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"text-left q-pa-xs"},{default:(0,n.w5)((()=>[(0,n._)("div",a,(0,r.zw)(t.row.usage),1)])),_:2},1024),(0,n.Wm)(c,{color:e.isDark?"grey-7":""},null,8,["color"]),(0,n.Wm)(u,{class:"q-pa-xs text-grey-6"},{default:(0,n.w5)((()=>[(0,n._)("div",null,(0,r.zw)(t.row.description),1)])),_:2},1024)])),_:2},1032,["dark"])])),_:1},8,["rows","columns","dark","class"])}var i=o(1959);const s=(0,n.aZ)({name:"FunctionsTable",props:{functions:{type:Array},filter:{type:String,default:""},theme:{type:String,default:"white"}},setup(e){const t=(0,i.Vh)(e,"filter"),o=(0,i.Fl)((()=>"dark"===e.theme)),n=(0,i.Fl)((()=>{const o=t.value.toLowerCase();let n=e.functions||[];return o&&n.length&&(n=n.filter((e=>-1!==e.usage.indexOf(o)))),n})),r=[{name:"usage",label:"Function",align:"center",field:"usage"},{name:"description",label:"Description",align:"left",field:"description"}];return{cols:r,funcs:n,isDark:o}}});var u=o(4260),c=o(2001),d=o(151),p=o(5589),m=o(5869),f=o(7518),g=o.n(f);const h=(0,u.Z)(s,[["render",l]]),v=h;g()(s,"components",{QTable:c.Z,QCard:d.Z,QCardSection:p.Z,QSeparator:m.Z})},8230:(e,t,o)=>{o.r(t),o.d(t,{default:()=>lt});var n=o(3673),r=o(2323);const a={class:"q-pb-sm",style:{height:"120px"}},l=(0,n.Uk)("Show all functions");function i(e,t,o,i,s,u){const c=(0,n.up)("expression-input"),d=(0,n.up)("q-tooltip"),p=(0,n.up)("q-btn"),m=(0,n.up)("messages-table");return(0,n.wg)(),(0,n.iD)("div",{class:(0,r.C_)(["q-pa-sm window-height",{"bg-grey-9":"dark"===e.theme}])},[(0,n._)("div",a,[(0,n.Wm)(c,{modelValue:e.expression,"onUpdate:modelValue":t[0]||(t[0]=t=>e.expression=t),errors:e.dataMappedErrors||e.errors,functions:e.functions,cols:e.messagesFields,theme:e.theme},null,8,["modelValue","errors","functions","cols","theme"]),(0,n.Wm)(p,{round:"",flat:"",color:"dark"===e.theme?"white":"",icon:"mdi-information-outline",onClick:e.showFunctions,class:"absolute-top-right",style:{right:"8px",top:"8px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[l])),_:1})])),_:1},8,["color","onClick"])]),(0,n.Wm)(m,{style:{height:"calc(100% - 120px)"},messages:e.input,cols:e.cols||e.messagesFields,"validate-models":e.validation,theme:e.theme,"onUpdate:cell":e.updateCellHandler,"onUpdate:messages":e.updateInput,"onShow:error":e.setDataError},null,8,["messages","cols","validate-models","theme","onUpdate:cell","onUpdate:messages","onShow:error"])],2)}var s=o(2498),u=o(8825),c=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};function d(e,t){let o=null;return(...n)=>(o&&clearTimeout(o),new Promise(((r,a)=>{const l=new Promise((e=>{o=setTimeout(e,t)}));l.then((()=>c(this,void 0,void 0,(function*(){r(yield e(...n))})))).catch((e=>a(e)))})))}var p=o(1959);const m=(0,n._)("div",{class:"q-table__title"},"Messages",-1),f=(0,n.Uk)("Show messages with result"),g=(0,n.Uk)("Import"),h=(0,n.Uk)("Edit JSON"),v={key:0,class:"text-bold text-italic"},w={key:1,class:"text-bold"};function y(e,t,o,a,l,i){const s=(0,n.up)("q-space"),u=(0,n.up)("q-file"),c=(0,n.up)("q-tooltip"),d=(0,n.up)("q-toggle"),p=(0,n.up)("q-btn"),y=(0,n.up)("q-input"),b=(0,n.up)("q-popup-edit"),k=(0,n.up)("q-td"),x=(0,n.up)("q-tr"),C=(0,n.up)("q-table");return(0,n.wg)(),(0,n.j4)(C,{class:(0,r.C_)(["messages-table",{"messages-table--col-info":e.validateModels.length,"bg-grey-9":e.isDark,"messages-table--dark-theme":e.isDark}]),title:"Messages",rows:e.filteredMessages,dense:e.messages.length>20,columns:e.columns,"row-key":"name","hide-pagination":"","rows-per-page-options":[0],dark:e.isDark},{top:(0,n.w5)((()=>[m,(0,n.Wm)(s),(0,n.Wm)(u,{class:"hidden",ref:"fileCtrl",modelValue:e.file,"onUpdate:modelValue":t[0]||(t[0]=t=>e.file=t),accept:".json"},null,8,["modelValue"]),(0,n.Wm)(d,{flat:"",round:"",icon:"mdi-format-list-bulleted-square",disable:!e.validateModels.length,modelValue:e.needFilterByResult,"onUpdate:modelValue":t[1]||(t[1]=t=>e.needFilterByResult=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[f])),_:1})])),_:1},8,["disable","modelValue"]),(0,n.Wm)(p,{flat:"",round:"",icon:"mdi-playlist-plus",onClick:t[2]||(t[2]=t=>e.importJson(t))},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[g])),_:1})])),_:1}),(0,n.Wm)(p,{round:"",class:"q-ml-sm",flat:"",onClick:e.showEditDialog,icon:"mdi-code-braces"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[h])),_:1})])),_:1},8,["onClick"])])),body:(0,n.w5)((o=>[(0,n.Wm)(x,{props:o,onMouseover:t=>e.setHoveredMessage(o.rowIndex),onMouseleave:t[3]||(t[3]=t=>e.removeHoveredMessage())},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.cols,(t=>((0,n.wg)(),(0,n.j4)(k,{key:t.name,props:o,class:(0,r.C_)([e.highlightCol(t,o.rowIndex)])},{default:(0,n.w5)((()=>{var a,l,i;return["__result"===t.field?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[void 0===(null===(a=e.filteredValidateModels[o.rowIndex])||void 0===a?void 0:a.result)?((0,n.wg)(),(0,n.iD)("span",v,(0,r.zw)(null===(l=e.filteredValidateModels[o.rowIndex].error)||void 0===l?void 0:l.reason),1)):((0,n.wg)(),(0,n.iD)("span",w,(0,r.zw)(null===(i=e.filteredValidateModels[o.rowIndex])||void 0===i?void 0:i.result),1))],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)((0,r.zw)(o.row[t.name])+" ",1),(0,n.Wm)(b,{color:e.isDark?"grey-9":"","model-value":e.getEditValue(o.row[t.name]),"onUpdate:modelValue":n=>e.$emit("update:cell",...e.updateCell(t.name,o.rowIndex,n)),title:`Update ${t.name}`,buttons:"",persistent:""},{default:(0,n.w5)((t=>[(0,n.Wm)(y,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,dense:"",autofocus:"",color:e.isDark?"grey-9":""},null,8,["modelValue","onUpdate:modelValue","color"])])),_:2},1032,["color","model-value","onUpdate:modelValue","title"])],64))]})),_:2},1032,["props","class"])))),128))])),_:2},1032,["props","onMouseover"])])),_:1},8,["class","rows","dense","columns","dark"])}function b(e,t,o,a,l,i){const s=(0,n.up)("json-input"),u=(0,n.up)("q-card-section"),c=(0,n.up)("q-btn"),d=(0,n.up)("q-card-actions"),p=(0,n.up)("q-card"),m=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.j4)(m,{ref:"dialogRef",onHide:e.onHide,onShow:e.showCode,"full-width":"","full-height":""},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{class:(0,r.C_)(["q-dialog-plugin",{"bg-grey-9":e.isDark}])},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"q-pa-none",style:{height:"calc(100% - 50px)"}},{default:(0,n.w5)((()=>[e.isCodeVisible?((0,n.wg)(),(0,n.j4)(s,{key:0,modelValue:e.input,"onUpdate:modelValue":t[0]||(t[0]=t=>e.input=t),theme:e.theme},null,8,["modelValue","theme"])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(d,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{flat:"",label:"OK",onClick:e.onOKClick,color:e.isDark?"white":""},null,8,["onClick","color"]),(0,n.Wm)(c,{flat:"",label:"Cancel",onClick:e.onCancelClick,color:e.isDark?"white":""},null,8,["onClick","color"])])),_:1})])),_:1},8,["class"])])),_:1},8,["onHide","onShow"])}var k=o(8777);function x(e,t,o,a,l,i){return(0,n.wg)(),(0,n.iD)("div",{ref:"codeMirrorRef",class:(0,r.C_)(["code-editor__container",{"code-editor__container--errors":e.error,[`code-editor__container--theme-${e.theme}`]:!0}])},null,2)}var C=o(3193),_=o(8111),D=o(1638),J=o(7797),V=o(5306),Z=o(6049),q=o(7677),F=o(5323),M=o(381),S=o(8782);const O=S.tk.theme({"&":{height:"100%"},"&:focus":{outline:"none !important"}}),R=[{key:"Tab",run(e){return(0,C.dk)(e)}},{key:"Shift-Space",run:C.WA}],H={defaultKeymap:new M.F6,historyKeymap:new M.F6,completionKeymap:new M.F6,commentKeymap:new M.F6,customKeyMap:new M.F6,theme:new M.F6,highlight:new M.F6,autocomplition:new M.F6,panel:new M.F6,lang:new M.F6},E=[H.defaultKeymap.of(S.$f.of(_.wQ)),H.historyKeymap.of(S.$f.of(Z.f$)),H.customKeyMap.of(S.$f.of(R)),H.completionKeymap.of(S.$f.of(C.B1)),H.commentKeymap.of(S.$f.of(D.Du)),H.autocomplition.of((0,C.ys)({activateOnTyping:!0,defaultKeymap:!0})),H.panel.of([]),H.highlight.of(V.R_),H.theme.of(O),H.lang.of([])];function Q(e){const t=(0,p.iH)(),o=(0,p.iH)(),{onChange:r}=e;return(0,n.bv)((()=>{if(!t.value)return;const n=M.yy.create({doc:e.initialDoc,extensions:[...E,(0,J.Eu)(),(0,J.HQ)(),(0,Z.m8)(),(0,q.nY)(),(0,F.n)(),(0,S.ZO)(),S.tk.lineWrapping,S.tk.updateListener.of((e=>{r&&r(e)}))]}),a=new S.tk({state:n,parent:t.value});o.value=a})),{codeMirrorRef:t,codeMirrorView:o}}var W=o(435),B=o(1924);function N(e,t){const o=[],r=S.tk.theme({"&":{height:"100%",color:"#424242",backgroundColor:"white",borderRadius:"4px"},"&:focus":{outline:"none !important"},".cm-gutters":{borderRadius:"4px"},".cm-panels-bottom":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px"},".cm-panel-errors":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px",backgroundColor:"#ffcdd2"}}),a=S.tk.theme({"&":{height:"100%",color:"white",backgroundColor:"#616161",borderRadius:"4px"},"&:focus":{outline:"none !important"},".cm-content":{caretColor:"#f5f5f5"},"&.cm-focused .cm-cursor":{borderLeftColor:"#f5f5f5"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#212121"},".cm-activeLine":{backgroundColor:"#616161"},".cm-gutters":{color:"#aaa",backgroundColor:"#616161",border:"none",borderRadius:"4px"},".cm-activeLineGutter":{backgroundColor:"#616161",color:"#fff"},".cm-panels-bottom":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px"},".cm-panel-errors":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px",backgroundColor:"#d32f2f"}},{dark:!0});if(o.push(H.theme.reconfigure("dark"===t.value?a:r)),"dark"===t.value){const e=V.Qf.define([{tag:V.pJ.string,color:"#ff9898"},{tag:V.pJ.number,color:"#83f1ff"},{tag:V.pJ.bool,color:"#cfc8ff"}]);o.push(H.highlight.reconfigure(e))}(0,n.bv)((()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:o})}))}function P(e,t){(0,n.YP)(t,(t=>{var o;function n(){const e=document.createElement("div");return e.textContent=t||null,e.className="cm-panel-errors q-pa-xs text-italic text-weight-medium",{dom:e}}null===(o=e.value)||void 0===o||o.dispatch({effects:H.panel.reconfigure(t?B.mH.of(n):[])})}),{immediate:!0})}const A=(0,n.aZ)({props:{modelValue:{type:String,default:"",required:!0},error:{type:String,default:""},theme:{type:String,default:"white"}},emits:[...k.Z.emits,"update:modelValue"],setup(e,{emit:t}){const{modelValue:o,error:r,theme:a}=(0,p.BK)(e),l=(0,p.Fl)((()=>"dark"===e.theme)),{codeMirrorRef:i,codeMirrorView:s}=Q({initialDoc:o.value,onChange(e){e.docChanged&&t("update:modelValue",e.state.doc.toString())}});return P(s,r),N(s,a),(0,n.bv)((()=>{var e;null===(e=s.value)||void 0===e||e.dispatch({effects:H.lang.reconfigure((0,W.AV)())})})),{isDark:l,codeMirrorRef:i,codeMirrorView:s}}});var K=o(4260);const T=(0,K.Z)(A,[["render",x]]),I=T,U=e=>{const t={};try{let o=JSON.parse(e);Array.isArray(o)||(o=[o]),t.result=o}catch(o){t.error=o.message}return t},j=(0,n.aZ)({props:{data:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},emits:[...k.Z.emits],components:{JsonInput:I},setup(e){const{dialogRef:t,onDialogHide:o,onDialogOK:n,onDialogCancel:r}=(0,k.Z)(),{data:a}=(0,p.BK)(e),l=(0,p.iH)(JSON.stringify(a.value,void 0,2)),i=(0,p.iH)(""),s=(0,p.Fl)((()=>"dark"===e.theme)),u=(0,p.iH)(!1),c=()=>{u.value=!0};return{input:l,error:i,isDark:s,isCodeVisible:u,showCode:c,dialogRef:t,onHide(){o()},onOKClick(){const e=U(l.value);e.error?i.value=e.error:n(e.result)},onCancelClick:r}}});var $=o(5926),L=o(151),Y=o(5589),z=o(9367),G=o(8240),X=o(7518),ee=o.n(X);const te=(0,K.Z)(j,[["render",b]]),oe=te;ee()(j,"components",{QDialog:$.Z,QCard:L.Z,QCardSection:Y.Z,QCardActions:z.Z,QBtn:G.Z});var ne=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};function re(e,t){const o=e.value.reduce(((e=[],t)=>(e.push({name:t,label:t,align:"center",field:t}),e)),[]);return e.value.length&&t.value.length&&(null===o||void 0===o||o.unshift({name:"Expression result",label:"Expression result",align:"center",field:"__result",classes:"result-col",headerClasses:"result-col result-col__header"})),o}function ae(e,t){const o=(0,p.Fl)((()=>{let e={data:2,results:3};return"dark"===t.value&&(e={data:8,results:9}),e})),n=(e,o=2)=>{let n="";return e&&(n=void 0!==e.result?`bg-purple-${o}`:"bg-"+("dark"===t.value?"grey-9":"white")),n};function r(t,r){const a=e.value[r];let l;return l="__result"===(null===t||void 0===t?void 0:t.field)?n(a,o.value.results):n(a,o.value.data),l}return{highlightLevels:o,highlightCol:r}}function le(e){const t=e=>"string"===typeof e?e:JSON.stringify(e),o=(t,o,n)=>{const r=typeof e.value[o][t];let a=n;if("string"!==r)try{a=JSON.parse(n)}catch(l){a=void 0}return[t,o,a]};return{getEditValue:t,updateCell:o}}function ie(){const e=(0,p.iH)(null),t=(0,n.FN)(),o=(0,p.iH)(null),r=e=>{const t=new FileReader;return new Promise(((o,n)=>{t.onload=()=>{o(t.result)},t.onerror=n,t.readAsText(e)}))},a=()=>new Promise(((t,a)=>{const l=(0,n.YP)(o,(o=>ne(this,void 0,void 0,(function*(){const n=e.value;if(o instanceof File){const e=yield r(o);n.removeAtIndex(0);try{let o=JSON.parse(e);Array.isArray(o)||(o=[o]),t(o)}catch(i){a(i)}l()}}))))})),l=o=>{const n=e.value;return n.pickFiles(o),a().then((e=>{t.emit("update:messages",e)}))};return{fileCtrl:e,file:o,importJson:l}}const se=(e,t)=>{const o=(0,p.iH)(!1),n=(0,p.Fl)((()=>{let n=e.value||[];return o.value&&t.value.length&&(n=n.filter(((e,o)=>{const n=t.value[o];return void 0!==n.result}))),n})),r=(0,p.Fl)((()=>{let e=t.value;return o.value&&(e=e.filter((e=>void 0!==e.result))),e}));return{needFilterByResult:o,filteredMessages:n,filteredValidateModels:r}},ue=(0,n.aZ)({name:"MessagesTable",props:{messages:{type:Array,default:()=>[],required:!0},cols:{type:Array,default:()=>[],required:!0},validateModels:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},setup(e,{emit:t}){const{messages:o,validateModels:n,cols:r,theme:a}=(0,p.BK)(e),l=(0,p.Fl)((()=>re(r,n))),i=(0,p.Fl)((()=>"dark"===a.value)),s=(0,u.Z)(),c=()=>{s.dialog({component:oe,componentProps:{data:o.value,theme:e.theme}}).onOk((e=>t("update:messages",e)))};function d(e){let o;return{setHoveredMessage(n){const r=e.value[n];(null===r||void 0===r?void 0:r.error)&&(o=r.error,t("show:error",r.error))},removeHoveredMessage(){o&&t("show:error")}}}const{needFilterByResult:m,filteredMessages:f,filteredValidateModels:g}=se(o,n);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({columns:l,isDark:i},ie()),le(o)),{showEditDialog:c,needFilterByResult:m,filteredMessages:f,filteredValidateModels:g}),d(g)),ae(g,a))},emits:["update:cell","update:messages","show:error"]});var ce=o(2001),de=o(2025),pe=o(4974),me=o(8886),fe=o(8870),ge=o(8186),he=o(3884),ve=o(1289),we=o(4689);const ye=(0,K.Z)(ue,[["render",y]]),be=ye;ee()(ue,"components",{QTable:ce.Z,QSpace:de.Z,QFile:pe.Z,QToggle:me.Z,QTooltip:fe.Z,QBtn:G.Z,QTr:ge.Z,QTd:he.Z,QPopupEdit:ve.Z,QInput:we.Z});const ke={class:"col-2 text-center"};function xe(e,t,o,a,l,i){const s=(0,n.up)("functions-table"),u=(0,n.up)("q-card-section"),c=(0,n.up)("q-input"),d=(0,n.up)("q-btn"),p=(0,n.up)("q-card-actions"),m=(0,n.up)("q-card"),f=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.j4)(f,{ref:"dialogRef",onHide:e.onDialogHide},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{class:(0,r.C_)(["q-dialog-plugin",{"bg-grey-9":e.isDark}]),style:{"min-width":"50vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{style:{height:"90vh"},class:"scroll q-pa-none"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{functions:e.functions,filter:e.filter,theme:e.theme},null,8,["functions","filter","theme"])])),_:1}),(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filter=t),type:"text",label:"Filter",class:"col-10",dark:e.isDark,standout:"bg-grey-4 text-grey-9"},null,8,["modelValue","dark"]),(0,n._)("div",ke,[(0,n.Wm)(d,{flat:"",label:"Close",onClick:e.onCancelClick,color:e.isDark?"white":""},null,8,["onClick","color"])])])),_:1})])),_:1},8,["class"])])),_:1},8,["onHide"])}var Ce=o(3718);const _e=(0,n.aZ)({props:{functions:{type:Array},theme:{type:String,default:"white"}},components:{FunctionsTable:Ce.Z},emits:[...k.Z.emits],setup(e){const{dialogRef:t,onDialogHide:o,onDialogOK:n,onDialogCancel:r}=(0,k.Z)(),a=(0,p.iH)(""),l=(0,p.Fl)((()=>"dark"===e.theme));return{filter:a,isDark:l,dialogRef:t,onDialogHide:o,onOKClick(){n()},onCancelClick:r}}}),De=(0,K.Z)(_e,[["render",xe]]),Je=De;function Ve(e,t,o,a,l,i){return(0,n.wg)(),(0,n.iD)("div",{ref:"codeMirrorRef",class:(0,r.C_)(["code-editor__container",{"code-editor__container--errors":e.errors,[`code-editor__container--theme-${e.theme}`]:!0}])},null,2)}ee()(_e,"components",{QDialog:$.Z,QCard:L.Z,QCardSection:Y.Z,QCardActions:z.Z,QInput:we.Z,QBtn:G.Z});var Ze=o(9405),qe=o(5621);const Fe=q.qp.define({parser:qe.E.configure({props:[(0,V.Gv)({BooleanLiteral:V.pJ.bool,null:V.pJ["null"],VariableName:V.pJ.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":V.pJ["function"](V.pJ.variableName),VariableDefinition:V.pJ.definition(V.pJ.variableName),Label:V.pJ.labelName,PropertyName:V.pJ.propertyName,PrivatePropertyName:V.pJ.special(V.pJ.propertyName),"CallExpression/MemberExpression/PropertyName":V.pJ["function"](V.pJ.propertyName),"FunctionDeclaration/VariableDefinition":V.pJ["function"](V.pJ.definition(V.pJ.variableName)),"ClassDeclaration/VariableDefinition":V.pJ.definition(V.pJ.className),PropertyDefinition:V.pJ.definition(V.pJ.propertyName),PrivatePropertyDefinition:V.pJ.definition(V.pJ.special(V.pJ.propertyName)),UpdateOp:V.pJ.updateOperator,LineComment:V.pJ.lineComment,BlockComment:V.pJ.blockComment,Number:V.pJ.number,String:V.pJ.string,ArithOp:V.pJ.arithmeticOperator,LogicOp:V.pJ.logicOperator,BitOp:V.pJ.bitwiseOperator,CompareOp:V.pJ.compareOperator,RegExp:V.pJ.regexp,Equals:V.pJ.definitionOperator,"Arrow : Spread":V.pJ.punctuation,"( )":V.pJ.paren,"[ ]":V.pJ.squareBracket,"{ }":V.pJ.brace,"InterpolationStart InterpolationEnd":V.pJ.special(V.pJ.brace),".":V.pJ.derefOperator,", ;":V.pJ.separator})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"']},wordChars:"$#"}});function Me(e={}){return new q.ri(Fe,Fe.data.of({autocomplete:(0,C.Mb)(e.complitions||[])}))}const Se=M.Py.define(),Oe=M.Py.define(),Re=M.QQ.define({create(){return S.p.none},update(e,t){e=e.map(t.changes);for(const o of t.effects)o.is(Se)?e=e.update({add:[He.range(o.value.from,o.value.to)]}):o.is(Oe)&&(e=e.update({filter:(e,t,o)=>"cm-underline"!==o.spec.class}));return e},provide:e=>S.tk.decorations.from(e)}),He=S.p.mark({class:"cm-underline"}),Ee=S.tk.baseTheme({".cm-underline":{textDecoration:"underline wavy red 1px"}});function Qe(e,t){let o=t.column||0;const n=e.state.doc.length;if(!n)return!1;o===n&&(o=0);const r=[Se.of({from:o,to:n})];return e.state.field(Re,!1)||r.push(M.Py.appendConfig.of([Re,Ee])),e.dispatch({effects:r}),!0}function We(e,t){let o=t.column||0;const n=e.state.doc.length;if(!n)return!1;o===n&&(o=0);const r=[Oe.of({from:o,to:n})];return e.dispatch({effects:r}),!0}function Be(e,t){(0,n.YP)(t,(t=>{var o;function n(){const e=document.createElement("div"),o=()=>(null===t||void 0===t?void 0:t.map((e=>e.reason)).join(", "))||null;return e.textContent=o(),e.className="cm-panel-errors q-pa-xs text-italic text-weight-medium",{dom:e}}null===(o=e.value)||void 0===o||o.dispatch({effects:H.panel.reconfigure(t?B.mH.of(n):[])})}),{immediate:!0})}function Ne(e,t,o){const r=function(){var e,n;const r=null===(e=t.value)||void 0===e?void 0:e.reduce(((e,t)=>(e.push({label:t.name,type:"function",apply:t.usage,detail:t.description}),e)),[]),a=null===(n=o.value)||void 0===n?void 0:n.reduce(((e,t)=>(e.push({label:t,type:"keyword"}),e)),[]);return[...r||[],...a||[]]},a=()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:H.autocomplition.reconfigure((0,C.ys)({override:[e=>{const t=e.matchBefore(/\w*/);return!t||t.from===t.to&&!e.explicit?null:{from:t.from,options:r()||[]}}]}))})};(0,n.YP)(t,a)}function Pe(e){(0,n.bv)((()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:H.lang.reconfigure(Me())})}))}function Ae(e,t){(0,n.YP)(t,(t=>{var o,n;const r=null===(o=e.value)||void 0===o?void 0:o.state.doc.toString();t!==r&&(null===(n=e.value)||void 0===n||n.dispatch({changes:{from:0,to:null===r||void 0===r?void 0:r.length,insert:t}}))}))}function Ke(e,t){(0,n.YP)(t,((t,o)=>{e.value&&(o&&o.length&&We(e.value,o[0]),t&&t.length&&Qe(e.value,t[0]))}))}function Te(e){const t=setInterval((()=>{e.value&&(e.value.focus(),e.value.hasFocus&&clearInterval(t))}),500)}const Ie=(0,n.aZ)({name:"ExpressionInput",props:{modelValue:String,errors:{type:Array},functions:{type:Array},cols:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},emits:["update:modelValue"],setup(e,{emit:t}){const{modelValue:o,functions:n,errors:r,cols:a,theme:l}=(0,p.BK)(e),i=(0,p.Fl)({get(){return o.value||""},set:(0,Ze.Z)((e=>{t("update:modelValue",e)}))}),{codeMirrorRef:s,codeMirrorView:u}=Q({initialDoc:i.value,onChange(e){e.docChanged&&(i.value=e.state.doc.toString())}});return Be(u,r),Ne(u,n,a),Pe(u),N(u,l),Ae(u,o),Ke(u,r),Te(u),{expression:i,codeMirrorRef:s,codeMirrorView:u}}}),Ue=(0,K.Z)(Ie,[["render",Ve]]),je=Ue;var $e=o(687);class Le{constructor(){const e=(0,$e.Z)();this.bus=e,this.postkey=window.name,window.addEventListener("message",(e=>{let t,o;if("string"===typeof e.data&&0===e.data.indexOf("FlespiTools|")){let r=e.data.split("|");r=r[this.postkey?2:1].split("=>"),t=r[0];try{o=JSON.parse(r[1])}catch(n){o=r[1]}t&&this.bus.emit(t,o)}}))}on(e,t){this.bus.on(e,t)}send(e,t){e=`FlespiTools${this.postkey?`|${this.postkey}`:""}|${e}${t?`=>${JSON.stringify(t)}`:""}`,(null===window||void 0===window?void 0:window.parent)!==window&&(null===window||void 0===window||window.parent.postMessage(e,"*"));const o=window.opener;null===o||void 0===o||o.postMessage(e,"*")}}const Ye=new Le;function ze(){return{bus:Ye}}const{bus:Ge}=ze();function Xe(e){Ge.on("ExpressionsSetData",(t=>{let o=t;Array.isArray(o)||(o=[o]),e(o)}))}function et(e){Ge.on("ExpressionsSetExpression",(t=>{const o=t;e(o)}))}function tt(e){Ge.on("ExpressionsSetColumns",(t=>{const o=t;e(o)}))}function ot(){Ge.send("ready")}var nt=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};const rt=(0,n.aZ)({props:{theme:{type:String,default:"white"}},components:{MessagesTable:be,ExpressionInput:je},setup(e){const{theme:t}=(0,p.BK)(e),o=(0,u.Z)(),r=(0,s.useStore)(),a=(0,p.iH)([]),l=(0,p.iH)([]),i=(0,p.iH)(),c=(0,p.Fl)({get(){return r.state.expressions.expression},set(e){r.commit("expressions/setExpr",e)}}),m=(0,p.Fl)({get(){return r.state.expressions.input},set(e){r.commit("expressions/setInput",e)}}),f=(0,p.Fl)((()=>Object.keys(m.value.reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{})))),g=(0,p.Fl)((()=>r.state.expressions.functions)),h=()=>{o.dialog({component:Je,componentProps:{functions:g.value,theme:t.value}})},v=d((()=>r.dispatch("expressions/validateExpression")),3e3),w=()=>r.dispatch("expressions/validateExpression",{onlyValidate:!0}),y=()=>nt(this,void 0,void 0,(function*(){const e=yield w();if(l.value=e.errors,e.errors)a.value=[];else{const e=yield v();a.value=e.result,l.value=e.errors}})),b=e=>{m.value=e},k=(e,t,o)=>{r.commit("expressions/updateCell",{index:t,name:e,data:o}),y()};r.dispatch("expressions/getExpressionFunctions"),(0,n.YP)([c,m],y,{immediate:!0}),Xe(b),et((e=>{c.value=e})),tt((e=>{i.value=e})),(0,n.bv)((()=>{ot()}));const x=(0,p.iH)(),C=(0,p.Fl)((()=>{let e;return x.value&&(e=[{code:2,reason:x.value.reason,column:x.value.column}]),e}));function _(e){x.value=e}return{expression:c,input:m,functions:g,updateInput:b,validation:a,errors:l,updateCellHandler:k,showFunctions:h,messagesFields:f,cols:i,setDataError:_,dataMappedErrors:C}}}),at=(0,K.Z)(rt,[["render",i]]),lt=at;ee()(rt,"components",{QBtn:G.Z,QTooltip:fe.Z})}}]);