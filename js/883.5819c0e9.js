"use strict";(globalThis["webpackChunkexpr_tool"]=globalThis["webpackChunkexpr_tool"]||[]).push([[883],{6105:(e,t,o)=>{o.d(t,{Z:()=>v});var n=o(3673),r=o(2323);const a={class:"text-h7 text-italic text-bold"};function l(e,t,o,l,i,s){const u=(0,n.up)("q-card-section"),c=(0,n.up)("q-separator"),d=(0,n.up)("q-card"),p=(0,n.up)("q-table");return(0,n.wg)(),(0,n.j4)(p,{rows:e.funcs,columns:e.cols,grid:"","row-key":"name","hide-pagination":"","rows-per-page-options":[0],dark:e.isDark,class:(0,r.C_)({"bg-grey-9":e.isDark})},{item:(0,n.w5)((t=>[(0,n.Wm)(d,{class:"q-mb-xs q-mx-xs",style:{width:"100%"},dark:e.isDark},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"text-left q-pa-xs"},{default:(0,n.w5)((()=>[(0,n._)("div",a,(0,r.zw)(t.row.usage),1)])),_:2},1024),(0,n.Wm)(c,{color:e.isDark?"grey-7":""},null,8,["color"]),(0,n.Wm)(u,{class:"q-pa-xs text-grey-6"},{default:(0,n.w5)((()=>[(0,n._)("div",null,(0,r.zw)(t.row.description),1)])),_:2},1024)])),_:2},1032,["dark"])])),_:1},8,["rows","columns","dark","class"])}var i=o(1959);const s=(0,n.aZ)({name:"FunctionsTable",props:{functions:{type:Array},filter:{type:String,default:""},theme:{type:String,default:"white"}},setup(e){const t=(0,i.Vh)(e,"filter"),o=(0,n.Fl)((()=>"dark"===e.theme)),r=(0,n.Fl)((()=>{const o=t.value.toLowerCase();let n=e.functions||[];return o&&n.length&&(n=n.filter((e=>-1!==e.usage.indexOf(o)))),n})),a=[{name:"usage",label:"Function",align:"center",field:"usage"},{name:"description",label:"Description",align:"left",field:"description"}];return{cols:a,funcs:r,isDark:o}}});var u=o(4260),c=o(2001),d=o(151),p=o(5589),m=o(5869),f=o(7518),g=o.n(f);const h=(0,u.Z)(s,[["render",l]]),v=h;g()(s,"components",{QTable:c.Z,QCard:d.Z,QCardSection:p.Z,QSeparator:m.Z})},9883:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ot});var n=o(3673),r=o(2323);const a={class:"q-pb-sm",style:{height:"120px"}};function l(e,t,o,l,i,s){const u=(0,n.up)("expression-input"),c=(0,n.up)("q-tooltip"),d=(0,n.up)("q-btn"),p=(0,n.up)("messages-table");return(0,n.wg)(),(0,n.iD)("div",{class:(0,r.C_)(["q-pa-sm window-height",{"bg-grey-9":"dark"===e.theme}])},[(0,n._)("div",a,[(0,n.Wm)(u,{modelValue:e.expression,"onUpdate:modelValue":t[0]||(t[0]=t=>e.expression=t),errors:e.dataMappedErrors||e.errors,functions:e.functions,cols:e.messagesFields,theme:e.theme},null,8,["modelValue","errors","functions","cols","theme"]),(0,n.Wm)(d,{round:"",flat:"",color:"dark"===e.theme?"white":"",icon:"mdi-information-outline",onClick:e.showFunctions,class:"absolute-top-right",style:{right:"8px",top:"8px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Show all functions")])),_:1})])),_:1},8,["color","onClick"])]),(0,n.Wm)(p,{style:{height:"calc(100% - 120px)"},messages:e.input,cols:e.cols||e.messagesFields,"validate-models":e.validation,theme:e.theme,"onUpdate:cell":e.updateCellHandler,"onUpdate:messages":e.updateInput,"onShow:error":e.setDataError},null,8,["messages","cols","validate-models","theme","onUpdate:cell","onUpdate:messages","onShow:error"])],2)}var i=o(2498),s=o(8825),u=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};function c(e,t){let o=null;return(...n)=>(o&&clearTimeout(o),new Promise(((r,a)=>{const l=new Promise((e=>{o=setTimeout(e,t)}));l.then((()=>u(this,void 0,void 0,(function*(){r(yield e(...n))})))).catch((e=>a(e)))})))}var d=o(1959);const p=(0,n._)("div",{class:"q-table__title"},"Messages",-1),m={key:0,class:"text-bold text-italic"},f={key:1,class:"text-bold"};function g(e,t,o,a,l,i){const s=(0,n.up)("q-space"),u=(0,n.up)("q-file"),c=(0,n.up)("q-tooltip"),d=(0,n.up)("q-toggle"),g=(0,n.up)("q-btn"),h=(0,n.up)("q-input"),v=(0,n.up)("q-popup-edit"),w=(0,n.up)("q-td"),y=(0,n.up)("q-tr"),b=(0,n.up)("q-table");return(0,n.wg)(),(0,n.j4)(b,{class:(0,r.C_)(["messages-table",{"messages-table--col-info":e.validateModels.length,"bg-grey-9":e.isDark,"messages-table--dark-theme":e.isDark}]),title:"Messages",rows:e.filteredMessages,dense:e.messages.length>20,columns:e.columns,"row-key":"name","hide-pagination":"","rows-per-page-options":[0],dark:e.isDark},{top:(0,n.w5)((()=>[p,(0,n.Wm)(s),(0,n.Wm)(u,{class:"hidden",ref:"fileCtrl",modelValue:e.file,"onUpdate:modelValue":t[0]||(t[0]=t=>e.file=t),accept:".json"},null,8,["modelValue"]),(0,n.Wm)(d,{flat:"",round:"",icon:"mdi-format-list-bulleted-square",disable:!e.validateModels.length,modelValue:e.needFilterByResult,"onUpdate:modelValue":t[1]||(t[1]=t=>e.needFilterByResult=t)},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Show messages with result")])),_:1})])),_:1},8,["disable","modelValue"]),(0,n.Wm)(g,{flat:"",round:"",icon:"mdi-playlist-plus",onClick:t[2]||(t[2]=t=>e.importJson(t))},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Import")])),_:1})])),_:1}),(0,n.Wm)(g,{round:"",class:"q-ml-sm",flat:"",onClick:e.showEditDialog,icon:"mdi-code-braces"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Edit JSON")])),_:1})])),_:1},8,["onClick"])])),body:(0,n.w5)((o=>[(0,n.Wm)(y,{props:o,onMouseover:t=>e.setHoveredMessage(o.rowIndex),onMouseleave:t[3]||(t[3]=t=>e.removeHoveredMessage())},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.cols,(t=>((0,n.wg)(),(0,n.j4)(w,{key:t.name,props:o,class:(0,r.C_)([e.highlightCol(t,o.rowIndex)])},{default:(0,n.w5)((()=>{var a,l,i;return["__result"===t.field?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[void 0===(null===(a=e.filteredValidateModels[o.rowIndex])||void 0===a?void 0:a.result)?((0,n.wg)(),(0,n.iD)("span",m,(0,r.zw)(null===(l=e.filteredValidateModels[o.rowIndex].error)||void 0===l?void 0:l.reason),1)):((0,n.wg)(),(0,n.iD)("span",f,(0,r.zw)(null===(i=e.filteredValidateModels[o.rowIndex])||void 0===i?void 0:i.result),1))],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)((0,r.zw)(o.row[t.name])+" ",1),(0,n.Wm)(v,{color:e.isDark?"grey-9":"","model-value":e.getEditValue(o.row[t.name]),"onUpdate:modelValue":n=>e.$emit("update:cell",...e.updateCell(t.name,o.rowIndex,n)),title:`Update ${t.name}`,buttons:"",persistent:""},{default:(0,n.w5)((t=>[(0,n.Wm)(h,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,dense:"",autofocus:"",color:e.isDark?"grey-9":""},null,8,["modelValue","onUpdate:modelValue","color"])])),_:2},1032,["color","model-value","onUpdate:modelValue","title"])],64))]})),_:2},1032,["props","class"])))),128))])),_:2},1032,["props","onMouseover"])])),_:1},8,["class","rows","dense","columns","dark"])}function h(e,t,o,a,l,i){const s=(0,n.up)("json-input"),u=(0,n.up)("q-card-section"),c=(0,n.up)("q-btn"),d=(0,n.up)("q-card-actions"),p=(0,n.up)("q-card"),m=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.j4)(m,{ref:"dialogRef",onHide:e.onHide,onShow:e.showCode,"full-width":"","full-height":""},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{class:(0,r.C_)(["q-dialog-plugin",{"bg-grey-9":e.isDark}])},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"q-pa-none",style:{height:"calc(100% - 50px)"}},{default:(0,n.w5)((()=>[e.isCodeVisible?((0,n.wg)(),(0,n.j4)(s,{key:0,modelValue:e.input,"onUpdate:modelValue":t[0]||(t[0]=t=>e.input=t),theme:e.theme},null,8,["modelValue","theme"])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(d,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{flat:"",label:"OK",onClick:e.onOKClick,color:e.isDark?"white":""},null,8,["onClick","color"]),(0,n.Wm)(c,{flat:"",label:"Cancel",onClick:e.onCancelClick,color:e.isDark?"white":""},null,8,["onClick","color"])])),_:1})])),_:1},8,["class"])])),_:1},8,["onHide","onShow"])}var v=o(8777);function w(e,t,o,a,l,i){return(0,n.wg)(),(0,n.iD)("div",{ref:"codeMirrorRef",class:(0,r.C_)(["code-editor__container",{"code-editor__container--errors":e.error,[`code-editor__container--theme-${e.theme}`]:!0}])},null,2)}var y=o(3193),b=o(8111),k=o(1638),x=o(7797),C=o(5306),_=o(6049),D=o(7677),J=o(5323),V=o(381),Z=o(8782);const q=Z.tk.theme({"&":{height:"100%"},"&:focus":{outline:"none !important"}}),F=[{key:"Tab",run(e){return(0,y.dk)(e)}},{key:"Shift-Space",run:y.WA}],M={defaultKeymap:new V.F6,historyKeymap:new V.F6,completionKeymap:new V.F6,commentKeymap:new V.F6,customKeyMap:new V.F6,theme:new V.F6,highlight:new V.F6,autocomplition:new V.F6,panel:new V.F6,lang:new V.F6},S=[M.defaultKeymap.of(Z.$f.of(b.wQ)),M.historyKeymap.of(Z.$f.of(_.f$)),M.customKeyMap.of(Z.$f.of(F)),M.completionKeymap.of(Z.$f.of(y.B1)),M.commentKeymap.of(Z.$f.of(k.Du)),M.autocomplition.of((0,y.ys)({activateOnTyping:!0,defaultKeymap:!0})),M.panel.of([]),M.highlight.of(C.R_),M.theme.of(q),M.lang.of([])];function O(e){const t=(0,d.iH)(),o=(0,d.iH)(),{onChange:r}=e;return(0,n.bv)((()=>{if(!t.value)return;const n=V.yy.create({doc:e.initialDoc,extensions:[...S,(0,x.Eu)(),(0,x.HQ)(),(0,_.m8)(),(0,D.nY)(),(0,J.n)(),(0,Z.ZO)(),Z.tk.lineWrapping,Z.tk.updateListener.of((e=>{r&&r(e)}))]}),a=new Z.tk({state:n,parent:t.value});o.value=a})),{codeMirrorRef:t,codeMirrorView:o}}var R=o(435),H=o(1924);function E(e,t){const o=[],r=Z.tk.theme({"&":{height:"100%",color:"#424242",backgroundColor:"white",borderRadius:"4px"},"&:focus":{outline:"none !important"},".cm-gutters":{borderRadius:"4px"},".cm-panels-bottom":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px"},".cm-panel-errors":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px",backgroundColor:"#ffcdd2"}}),a=Z.tk.theme({"&":{height:"100%",color:"white",backgroundColor:"#616161",borderRadius:"4px"},"&:focus":{outline:"none !important"},".cm-content":{caretColor:"#f5f5f5"},"&.cm-focused .cm-cursor":{borderLeftColor:"#f5f5f5"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#212121"},".cm-activeLine":{backgroundColor:"#616161"},".cm-gutters":{color:"#aaa",backgroundColor:"#616161",border:"none",borderRadius:"4px"},".cm-activeLineGutter":{backgroundColor:"#616161",color:"#fff"},".cm-panels-bottom":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px"},".cm-panel-errors":{borderBottomRightRadius:"4px",borderBottomLeftRadius:"4px",backgroundColor:"#d32f2f"}},{dark:!0});if(o.push(M.theme.reconfigure("dark"===t.value?a:r)),"dark"===t.value){const e=C.Qf.define([{tag:C.pJ.string,color:"#ff9898"},{tag:C.pJ.number,color:"#83f1ff"},{tag:C.pJ.bool,color:"#cfc8ff"}]);o.push(M.highlight.reconfigure(e))}(0,n.bv)((()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:o})}))}function Q(e,t){(0,n.YP)(t,(t=>{var o;function n(){const e=document.createElement("div");return e.textContent=t||null,e.className="cm-panel-errors q-pa-xs text-italic text-weight-medium",{dom:e}}null===(o=e.value)||void 0===o||o.dispatch({effects:M.panel.reconfigure(t?H.mH.of(n):[])})}),{immediate:!0})}const W=(0,n.aZ)({props:{modelValue:{type:String,default:"",required:!0},error:{type:String,default:""},theme:{type:String,default:"white"}},emits:[...v.Z.emits,"update:modelValue"],setup(e,{emit:t}){const{modelValue:o,error:r,theme:a}=(0,d.BK)(e),l=(0,n.Fl)((()=>"dark"===e.theme)),{codeMirrorRef:i,codeMirrorView:s}=O({initialDoc:o.value,onChange(e){e.docChanged&&t("update:modelValue",e.state.doc.toString())}});return Q(s,r),E(s,a),(0,n.bv)((()=>{var e;null===(e=s.value)||void 0===e||e.dispatch({effects:M.lang.reconfigure((0,R.AV)())})})),{isDark:l,codeMirrorRef:i,codeMirrorView:s}}});var B=o(4260);const N=(0,B.Z)(W,[["render",w]]),P=N,A=e=>{const t={};try{let o=JSON.parse(e);Array.isArray(o)||(o=[o]),t.result=o}catch(o){t.error=o.message}return t},K=(0,n.aZ)({props:{data:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},emits:[...v.Z.emits],components:{JsonInput:P},setup(e){const{dialogRef:t,onDialogHide:o,onDialogOK:r,onDialogCancel:a}=(0,v.Z)(),{data:l}=(0,d.BK)(e),i=(0,d.iH)(JSON.stringify(l.value,void 0,2)),s=(0,d.iH)(""),u=(0,n.Fl)((()=>"dark"===e.theme)),c=(0,d.iH)(!1),p=()=>{c.value=!0};return{input:i,error:s,isDark:u,isCodeVisible:c,showCode:p,dialogRef:t,onHide(){o()},onOKClick(){const e=A(i.value);e.error?s.value=e.error:r(e.result)},onCancelClick:a}}});var T=o(5926),I=o(151),U=o(5589),j=o(9367),$=o(8240),L=o(7518),Y=o.n(L);const z=(0,B.Z)(K,[["render",h]]),G=z;Y()(K,"components",{QDialog:T.Z,QCard:I.Z,QCardSection:U.Z,QCardActions:j.Z,QBtn:$.Z});var X=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};function ee(e,t){const o=e.value.reduce(((e=[],t)=>(e.push({name:t,label:t,align:"center",field:t}),e)),[]);return e.value.length&&t.value.length&&(null===o||void 0===o||o.unshift({name:"Expression result",label:"Expression result",align:"center",field:"__result",classes:"result-col",headerClasses:"result-col result-col__header"})),o}function te(e,t){const o=(0,n.Fl)((()=>{let e={data:2,results:3};return"dark"===t.value&&(e={data:8,results:9}),e})),r=(e,o=2)=>{let n="";return e&&(n=void 0!==e.result?`bg-purple-${o}`:"bg-"+("dark"===t.value?"grey-9":"white")),n};function a(t,n){const a=e.value[n];let l;return l="__result"===(null===t||void 0===t?void 0:t.field)?r(a,o.value.results):r(a,o.value.data),l}return{highlightLevels:o,highlightCol:a}}function oe(e){const t=e=>"string"===typeof e?e:JSON.stringify(e),o=(t,o,n)=>{const r=typeof e.value[o][t];let a=n;if("string"!==r)try{a=JSON.parse(n)}catch(l){a=void 0}return[t,o,a]};return{getEditValue:t,updateCell:o}}function ne(){const e=(0,d.iH)(null),t=(0,n.FN)(),o=(0,d.iH)(null),r=e=>{const t=new FileReader;return new Promise(((o,n)=>{t.onload=()=>{o(t.result)},t.onerror=n,t.readAsText(e)}))},a=()=>new Promise(((t,a)=>{const l=(0,n.YP)(o,(o=>X(this,void 0,void 0,(function*(){const n=e.value;if(o instanceof File){const e=yield r(o);n.removeAtIndex(0);try{let o=JSON.parse(e);Array.isArray(o)||(o=[o]),t(o)}catch(i){a(i)}l()}}))))})),l=o=>{const n=e.value;return n.pickFiles(o),a().then((e=>{t.emit("update:messages",e)}))};return{fileCtrl:e,file:o,importJson:l}}const re=(e,t)=>{const o=(0,d.iH)(!1),r=(0,n.Fl)((()=>{let n=e.value||[];return o.value&&t.value.length&&(n=n.filter(((e,o)=>{const n=t.value[o];return void 0!==n.result}))),n})),a=(0,n.Fl)((()=>{let e=t.value;return o.value&&(e=e.filter((e=>void 0!==e.result))),e}));return{needFilterByResult:o,filteredMessages:r,filteredValidateModels:a}},ae=(0,n.aZ)({name:"MessagesTable",props:{messages:{type:Array,default:()=>[],required:!0},cols:{type:Array,default:()=>[],required:!0},validateModels:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},setup(e,{emit:t}){const{messages:o,validateModels:r,cols:a,theme:l}=(0,d.BK)(e),i=(0,n.Fl)((()=>ee(a,r))),u=(0,n.Fl)((()=>"dark"===l.value)),c=(0,s.Z)(),p=()=>{c.dialog({component:G,componentProps:{data:o.value,theme:e.theme}}).onOk((e=>t("update:messages",e)))};function m(e){let o;return{setHoveredMessage(n){const r=e.value[n];(null===r||void 0===r?void 0:r.error)&&(o=r.error,t("show:error",r.error))},removeHoveredMessage(){o&&t("show:error")}}}const{needFilterByResult:f,filteredMessages:g,filteredValidateModels:h}=re(o,r);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({columns:i,isDark:u},ne()),oe(o)),{showEditDialog:p,needFilterByResult:f,filteredMessages:g,filteredValidateModels:h}),m(h)),te(h,l))},emits:["update:cell","update:messages","show:error"]});var le=o(2001),ie=o(2025),se=o(4974),ue=o(8886),ce=o(5363),de=o(8186),pe=o(3884),me=o(1289),fe=o(4689);const ge=(0,B.Z)(ae,[["render",g]]),he=ge;Y()(ae,"components",{QTable:le.Z,QSpace:ie.Z,QFile:se.Z,QToggle:ue.Z,QTooltip:ce.Z,QBtn:$.Z,QTr:de.Z,QTd:pe.Z,QPopupEdit:me.Z,QInput:fe.Z});const ve={class:"col-2 text-center"};function we(e,t,o,a,l,i){const s=(0,n.up)("functions-table"),u=(0,n.up)("q-card-section"),c=(0,n.up)("q-input"),d=(0,n.up)("q-btn"),p=(0,n.up)("q-card-actions"),m=(0,n.up)("q-card"),f=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.j4)(f,{ref:"dialogRef",onHide:e.onDialogHide},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{class:(0,r.C_)(["q-dialog-plugin",{"bg-grey-9":e.isDark}]),style:{"min-width":"50vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{style:{height:"80vh"},class:"scroll q-pa-none"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{functions:e.functions,filter:e.filter,theme:e.theme},null,8,["functions","filter","theme"])])),_:1}),(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filter=t),type:"text",label:"Filter",dense:"",class:"col-10",dark:e.isDark,standout:"bg-grey-4 text-grey-9"},null,8,["modelValue","dark"]),(0,n._)("div",ve,[(0,n.Wm)(d,{flat:"",label:"Close",onClick:e.onCancelClick,color:e.isDark?"white":""},null,8,["onClick","color"])])])),_:1})])),_:1},8,["class"])])),_:1},8,["onHide"])}var ye=o(6105);const be=(0,n.aZ)({props:{functions:{type:Array},theme:{type:String,default:"white"}},components:{FunctionsTable:ye.Z},emits:[...v.Z.emits],setup(e){const{dialogRef:t,onDialogHide:o,onDialogOK:r,onDialogCancel:a}=(0,v.Z)(),l=(0,d.iH)(""),i=(0,n.Fl)((()=>"dark"===e.theme));return{filter:l,isDark:i,dialogRef:t,onDialogHide:o,onOKClick(){r()},onCancelClick:a}}}),ke=(0,B.Z)(be,[["render",we]]),xe=ke;function Ce(e,t,o,a,l,i){return(0,n.wg)(),(0,n.iD)("div",{ref:"codeMirrorRef",class:(0,r.C_)(["code-editor__container",{"code-editor__container--errors":e.errors,[`code-editor__container--theme-${e.theme}`]:!0}])},null,2)}Y()(be,"components",{QDialog:T.Z,QCard:I.Z,QCardSection:U.Z,QCardActions:j.Z,QInput:fe.Z,QBtn:$.Z});var _e=o(9405),De=o(5621);const Je=D.qp.define({parser:De.E.configure({props:[(0,C.Gv)({BooleanLiteral:C.pJ.bool,null:C.pJ["null"],VariableName:C.pJ.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":C.pJ["function"](C.pJ.variableName),VariableDefinition:C.pJ.definition(C.pJ.variableName),Label:C.pJ.labelName,PropertyName:C.pJ.propertyName,PrivatePropertyName:C.pJ.special(C.pJ.propertyName),"CallExpression/MemberExpression/PropertyName":C.pJ["function"](C.pJ.propertyName),"FunctionDeclaration/VariableDefinition":C.pJ["function"](C.pJ.definition(C.pJ.variableName)),"ClassDeclaration/VariableDefinition":C.pJ.definition(C.pJ.className),PropertyDefinition:C.pJ.definition(C.pJ.propertyName),PrivatePropertyDefinition:C.pJ.definition(C.pJ.special(C.pJ.propertyName)),UpdateOp:C.pJ.updateOperator,LineComment:C.pJ.lineComment,BlockComment:C.pJ.blockComment,Number:C.pJ.number,String:C.pJ.string,ArithOp:C.pJ.arithmeticOperator,LogicOp:C.pJ.logicOperator,BitOp:C.pJ.bitwiseOperator,CompareOp:C.pJ.compareOperator,RegExp:C.pJ.regexp,Equals:C.pJ.definitionOperator,"Arrow : Spread":C.pJ.punctuation,"( )":C.pJ.paren,"[ ]":C.pJ.squareBracket,"{ }":C.pJ.brace,"InterpolationStart InterpolationEnd":C.pJ.special(C.pJ.brace),".":C.pJ.derefOperator,", ;":C.pJ.separator})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"']},wordChars:"$#"}});function Ve(e={}){return new D.ri(Je,Je.data.of({autocomplete:(0,y.Mb)(e.complitions||[])}))}const Ze=V.Py.define(),qe=V.Py.define(),Fe=V.QQ.define({create(){return Z.p.none},update(e,t){e=e.map(t.changes);for(const o of t.effects)o.is(Ze)?e=e.update({add:[Me.range(o.value.from,o.value.to)]}):o.is(qe)&&(e=e.update({filter:(e,t,o)=>"cm-underline"!==o.spec.class}));return e},provide:e=>Z.tk.decorations.from(e)}),Me=Z.p.mark({class:"cm-underline"}),Se=Z.tk.baseTheme({".cm-underline":{textDecoration:"underline wavy red 1px"}});function Oe(e,t){let o=t.column||0;const n=e.state.doc.length;if(!n)return!1;o===n&&(o=0);const r=[Ze.of({from:o,to:n})];return e.state.field(Fe,!1)||r.push(V.Py.appendConfig.of([Fe,Se])),e.dispatch({effects:r}),!0}function Re(e,t){let o=t.column||0;const n=e.state.doc.length;if(!n)return!1;o===n&&(o=0);const r=[qe.of({from:o,to:n})];return e.dispatch({effects:r}),!0}function He(e,t){(0,n.YP)(t,(t=>{var o;function n(){const e=document.createElement("div"),o=()=>(null===t||void 0===t?void 0:t.map((e=>e.reason)).join(", "))||null;return e.textContent=o(),e.className="cm-panel-errors q-pa-xs text-italic text-weight-medium",{dom:e}}null===(o=e.value)||void 0===o||o.dispatch({effects:M.panel.reconfigure(t?H.mH.of(n):[])})}),{immediate:!0})}function Ee(e,t,o){const r=function(){var e,n;const r=null===(e=t.value)||void 0===e?void 0:e.reduce(((e,t)=>(e.push({label:t.name,type:"function",apply:t.usage,detail:t.description}),e)),[]),a=null===(n=o.value)||void 0===n?void 0:n.reduce(((e,t)=>(e.push({label:t,type:"keyword"}),e)),[]);return[...r||[],...a||[]]},a=()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:M.autocomplition.reconfigure((0,y.ys)({override:[e=>{const t=e.matchBefore(/\w*/);return!t||t.from===t.to&&!e.explicit?null:{from:t.from,options:r()||[]}}]}))})};(0,n.YP)(t,a)}function Qe(e){(0,n.bv)((()=>{var t;null===(t=e.value)||void 0===t||t.dispatch({effects:M.lang.reconfigure(Ve())})}))}function We(e,t){(0,n.YP)(t,(t=>{var o,n;const r=null===(o=e.value)||void 0===o?void 0:o.state.doc.toString();t!==r&&(null===(n=e.value)||void 0===n||n.dispatch({changes:{from:0,to:null===r||void 0===r?void 0:r.length,insert:t}}))}))}function Be(e,t){(0,n.YP)(t,((t,o)=>{e.value&&(o&&o.length&&Re(e.value,o[0]),t&&t.length&&Oe(e.value,t[0]))}))}function Ne(e){const t=setInterval((()=>{e.value&&(e.value.focus(),e.value.hasFocus&&clearInterval(t))}),500)}const Pe=(0,n.aZ)({name:"ExpressionInput",props:{modelValue:String,errors:{type:Array},functions:{type:Array},cols:{type:Array,default:()=>[],required:!0},theme:{type:String,default:"white"}},emits:["update:modelValue"],setup(e,{emit:t}){const{modelValue:o,functions:r,errors:a,cols:l,theme:i}=(0,d.BK)(e),s=(0,n.Fl)({get(){return o.value||""},set:(0,_e.Z)((e=>{t("update:modelValue",e)}))}),{codeMirrorRef:u,codeMirrorView:c}=O({initialDoc:s.value,onChange(e){e.docChanged&&(s.value=e.state.doc.toString())}});return He(c,a),Ee(c,r,l),Qe(c),E(c,i),We(c,o),Be(c,a),Ne(c),{expression:s,codeMirrorRef:u,codeMirrorView:c}}}),Ae=(0,B.Z)(Pe,[["render",Ce]]),Ke=Ae;var Te=o(687);class Ie{constructor(){const e=(0,Te.Z)();this.bus=e,this.postkey=window.name,window.addEventListener("message",(e=>{let t,o;if("string"===typeof e.data&&0===e.data.indexOf("FlespiTools|")){let r=e.data.split("|");r=r[this.postkey?2:1].split("=>"),t=r[0];try{o=JSON.parse(r[1])}catch(n){o=r[1]}t&&this.bus.emit(t,o)}}))}on(e,t){this.bus.on(e,t)}send(e,t){e=`FlespiTools${this.postkey?`|${this.postkey}`:""}|${e}${t?`=>${JSON.stringify(t)}`:""}`,(null===window||void 0===window?void 0:window.parent)!==window&&(null===window||void 0===window||window.parent.postMessage(e,"*"));const o=window.opener;null===o||void 0===o||o.postMessage(e,"*")}}const Ue=new Ie;function je(){return{bus:Ue}}const{bus:$e}=je();function Le(e){$e.on("ExpressionsSetData",(t=>{let o=t;Array.isArray(o)||(o=[o]),e(o)}))}function Ye(e){$e.on("ExpressionsSetExpression",(t=>{const o=t;e(o)}))}function ze(e){$e.on("ExpressionsSetColumns",(t=>{const o=t;e(o)}))}function Ge(){$e.send("ready")}var Xe=function(e,t,o,n){function r(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function l(e){try{s(n.next(e))}catch(t){a(t)}}function i(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):r(e.value).then(l,i)}s((n=n.apply(e,t||[])).next())}))};const et=(0,n.aZ)({props:{theme:{type:String,default:"white"}},components:{MessagesTable:he,ExpressionInput:Ke},setup(e){const{theme:t}=(0,d.BK)(e),o=(0,s.Z)(),r=(0,i.o)(),a=(0,d.iH)([]),l=(0,d.iH)([]),u=(0,d.iH)(),p=(0,n.Fl)({get(){return r.state.expressions.expression},set(e){r.commit("expressions/setExpr",e)}}),m=(0,n.Fl)({get(){return r.state.expressions.input},set(e){r.commit("expressions/setInput",e)}}),f=(0,n.Fl)((()=>Object.keys(m.value.reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{})))),g=(0,n.Fl)((()=>r.state.expressions.functions)),h=()=>{o.dialog({component:xe,componentProps:{functions:g.value,theme:t.value}})},v=c((()=>r.dispatch("expressions/validateExpression")),3e3),w=()=>r.dispatch("expressions/validateExpression",{onlyValidate:!0}),y=()=>Xe(this,void 0,void 0,(function*(){const e=yield w();if(l.value=e.errors,e.errors)a.value=[];else{const e=yield v();a.value=e.result,l.value=e.errors}})),b=e=>{m.value=e},k=(e,t,o)=>{r.commit("expressions/updateCell",{index:t,name:e,data:o}),y()};r.dispatch("expressions/getExpressionFunctions"),(0,n.YP)([p,m],y,{immediate:!0}),Le(b),Ye((e=>{p.value=e})),ze((e=>{u.value=e})),(0,n.bv)((()=>{Ge()}));const x=(0,d.iH)(),C=(0,n.Fl)((()=>{let e;return x.value&&(e=[{code:2,reason:x.value.reason,column:x.value.column}]),e}));function _(e){x.value=e}return{expression:p,input:m,functions:g,updateInput:b,validation:a,errors:l,updateCellHandler:k,showFunctions:h,messagesFields:f,cols:u,setDataError:_,dataMappedErrors:C}}}),tt=(0,B.Z)(et,[["render",l]]),ot=tt;Y()(et,"components",{QBtn:$.Z,QTooltip:ce.Z})}}]);